(()=>{"use strict";var e={};e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),(()=>{var t;e.g.importScripts&&(t=e.g.location+"");var a=e.g.document;if(!t&&a&&(a.currentScript&&(t=a.currentScript.src),!t)){var n=a.getElementsByTagName("script");n.length&&(t=n[n.length-1].src)}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),e.p=t})(),e.p,e.p,e.p,e.p;const t=document.querySelectorAll("#show-new"),a=document.querySelector("#swich"),n=document.querySelector(".wrapper-content-switcher").children,i=document.querySelector("#filtre-loadMore"),c=document.querySelector("#loadMore"),o=document.querySelector("#content__list"),s=document.querySelector("#storage__list"),r=document.querySelector("#filtre__list"),l=document.querySelector("#search-form"),d=document.querySelector(".modal-warapp"),m=document.querySelector("#loader-in-filterList"),h=document.querySelector("#standart"),u=document.querySelector("#activeFilter"),g=new class{constructor(){this.__PAGE=1}addPage(){this.__PAGE+=1}async activeFetch(){try{const e=await fetch(`https://kinopoiskapiunofficial.tech/api/v2.2/films/top?type=TOP_100_POPULAR_FILMS&page=${this.__PAGE}`,{method:"GET",headers:{"X-API-KEY":"cb5f0c80-e1ab-45b3-8cee-3f02642f6379","Content-Type":"application/json"}});let{films:t}=await e.json();return this.addPage(),t=this.addMarked(t),t}catch(e){console.warn("Error when try to require in activeFetch: ",e.message)}}async activeIDFetch(e){try{const t=await fetch(`https://kinopoiskapiunofficial.tech/api/v2.2/films/${e}`,{method:"GET",headers:{"X-API-KEY":"cb5f0c80-e1ab-45b3-8cee-3f02642f6379","Content-Type":"application/json"}});return{...await t.json(),marked:!0}}catch(e){console.warn("Error when try to require in activeIDFetch: ",e.message)}}addMarked(e){return e.map((e=>({...e,marked:!1})))}checkIsMarked(e,t){for(let a=0;a<e.length;a++)for(let n=0;n<t.length;n++)if(t[n].filmId===+e[a]||t[n].kinopoiskId===+e[a]){t[n].marked=!0;break}return t}innerToHTML(e,t){e.innerHTML+=t}createCard(e){return e.map(((e,t)=>`\n                    <div class="col-3 d-flex content__list__item">\n                        <div class="content__list__item__wrapp">\n                            \x3c!-- Image and rating --\x3e\n                            <div class="content__list__item__header" style="background: url(${e.posterUrlPreview?e.posterUrlPreview:"null"}); background-repeat: no-repeat; background-size: cover">\n                                <span>${e.rating?[...e.rating][0]:"üê≥"}</span>\n                                <i data-id="${e.filmId?e.filmId:e.kinopoiskId}" class="fa-regular fa-bookmark ${e.marked?"active":""}"></i>\n                                \n                            </div>\n                            \x3c!-- END Image and rating --\x3e\n                            \x3c!-- About films --\x3e\n                            <div class="content__list__item__footer">\n                                <div class="content__list__item__footer__name">\n                                    <p data-id="${e.filmId}" class="">\n                                        ${e.nameRu}\n                                        <span>${e.year}</span>\n                                    </p>\n                                </div>\n                                <div  class="content__list__item__footer__ganre">\n                                    <p class="textToLowerCase">\n                                        ${e.genres.map((e=>e.genre)).join(", ")}\n                                    </p>\n                                </div>\n                            </div>\n                            \x3c!-- END About films --\x3e\n                        </div>\n                    </div>\n                `)).join(" ")}},f=new class{constructor(){this._lStorage=[],this.name="Films"}start(){const e=localStorage.getItem(this.name);this._lStorage=e?JSON.parse(e):[],localStorage.setItem(this.name,e||[])}addToStorage(){const e=JSON.stringify(this._lStorage);localStorage.setItem(this.name,e)}removeFromStorage(e){const t=this._lStorage.filter((t=>t!=e));this._lStorage=t}lStorage(e){this._lStorage=[...this._lStorage,e]}getData(){const e=localStorage.getItem(this.name);return e?JSON.parse(e):[]}},p=new class{async search(e){const t=`https://kinopoiskapiunofficial.tech/api/v2.1/films/search-by-keyword?keyword=${e}`,a=await fetch(t,{method:"GET",headers:{"X-API-KEY":"cb5f0c80-e1ab-45b3-8cee-3f02642f6379","Content-Type":"application/json"}}),{films:n}=await a.json();return n}},v=new class{createHTMLForModal({title:e,html:t}){return`\n            <div class="modal-dialog modal-xl">\n                    <div class="modal-content modal-background">\n                    <div class="modal-header">\n                        <h5 id="search-title" class="modal-title h4 textColor" id="exampleModalXlLabel">${e}</h5>\n                        <button id="search-close" type="button" class="btn-close textColor" data-bs-dismiss="modal" aria-label="Close"></button>\n                    </div>\n                    <div class="modal-body">\n                        <div class="container">\n                            <div class="row content__list d-flex flex-wrap" id="search__list">\n                                ${t}\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `}createEmojiCard(e){return e.map((e=>`\n            <div class="col-3 d-flex content__list__item">\n                <span class="emoji" data-id=${e.id}>\n                    ${e.emoji}\n                </span>\n            </div>\n            `)).join(" ")}},_=new class{constructor(){this.__PAGE=1}addPage(){this.__PAGE+=1}async activeFiltreFetch(e){const t=`https://kinopoiskapiunofficial.tech/api/v2.2/films?genres=${e}&order=RATING&type=ALL&ratingFrom=0&ratingTo=10&yearFrom=2000&yearTo=3000&page=${this.__PAGE}`,a=await fetch(t,{method:"GET",headers:{"X-API-KEY":"cb5f0c80-e1ab-45b3-8cee-3f02642f6379","Content-Type":"application/json"}}),{items:n}=await a.json();return n}};function L(){n[0].classList.toggle("d-none"),n[1].classList.toggle("d-none"),h.classList.toggle("active"),u.classList.toggle("active")}async function y(e){let t=await _.activeFiltreFetch(e);const a=f.getData();t=g.checkIsMarked(a,t),_.addPage();const n=g.createCard(t);g.innerToHTML(r,n),k()}function k(){m.classList.toggle("loader-active"),i.classList.toggle("btn-active")}function w(){t[0].classList.toggle("d-none"),t[1].classList.toggle("d-none")}function b(e){const t=e.target.dataset.id;"string"==typeof t&&(L(),T(),y(t),i.dataset.id=t,i.dataset.page=_.__PAGE)}function S(){d.classList.remove("d-none"),d.classList.add("d-block");const e=document.querySelector("#search__list"),t=document.querySelector("#search-close");e.addEventListener("click",E),t.addEventListener("click",T)}function T(){d.innerHTML="",d.classList.remove("d-block"),d.classList.add("d-none")}function E(e){const t=e.target,a=t.dataset.id;"I"!==t.tagName||t.classList.contains("active")?"I"===t.tagName&&t.classList.contains("active")&&(f.removeFromStorage(a),f.addToStorage(),t.classList.remove("active")):(f.lStorage(a),f.addToStorage(),t.classList.add("active"))}async function I(){let e=await g.activeFetch();const t=f.getData();e=g.checkIsMarked(t,e);const a=g.createCard(e);g.innerToHTML(o,a)}I(),f.start(),a.addEventListener("click",(function(e){const t=e.target;if(t.classList.contains("buttonActive"))t.classList.remove("buttonActive"),w(),s.innerHTML="";else{t.classList.add("buttonActive");const e=f.getData();e.length<=0?s.innerHTML='<h3 style="text-align:center; color:#fff"> –ù—ñ—á–æ–≥–æ –Ω–µ–º–∞—î </h3>':e.forEach((async e=>{const t=await g.activeIDFetch(e),a=g.createCard([t]);g.innerToHTML(s,a)})),w()}})),c.addEventListener("click",I),o.addEventListener("click",E),r.addEventListener("click",E),l.addEventListener("submit",(async function(e){e.preventDefault();const t=e.target.children[0].value.toLowerCase();e.target.children[0].value="";const a={title:`–ü–æ—à—É–∫ –∑–∞ —Å–ª–æ–≤–æ–º: ${t}`,html:""};let n=await p.search(t),i="";if(!n.length<=0){const e=f.getData();n=g.checkIsMarked(e,n),i=g.createCard(n),a.html=i}else i='<h3 style="text-align:center; color:#fff"> –ù—ñ—á–æ–≥–æ –Ω–µ–º–∞—î </h3>';const c=v.createHTMLForModal(a);g.innerToHTML(d,c),S()})),u.addEventListener("click",(function(e){if(!e.target.parentNode.classList.contains("active")){const e={title:"–û–±–µ—Ä–∏ —Å–º–∞–π–ª–∏–∫, —â–æ–± –ø–æ—á–∞—Ç–∏ —à—É–∫–∞—Ç–∏ —Ç–æ–±—ñ —Ñ—ñ–ª—å–º–∏!",html:"undefiend"},t=[{emoji:"üòÄ",id:"13"},{emoji:"üòä",id:"19"},{emoji:"üòé",id:"11"},{emoji:"üò¥",id:"22"},{emoji:"üòñ",id:"18"},{emoji:"üòù",id:"7"},{emoji:"ü¶æ",id:"6"},{emoji:"üòç",id:"2"},{emoji:"üëé",id:"17"}],a=v.createEmojiCard(t);e.html=a;const n=v.createHTMLForModal(e);g.innerToHTML(d,n),S(),document.querySelector("#search__list").addEventListener("click",b)}})),h.addEventListener("click",(function(e){e.path[1].classList.contains("active")||(r.innerHTML="",k(),L())})),i.addEventListener("click",(function(e){const t=e.target.dataset.id;k(),y(t)}))})();