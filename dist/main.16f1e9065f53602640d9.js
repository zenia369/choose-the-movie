(()=>{"use strict";var e={};e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),(()=>{var t;e.g.importScripts&&(t=e.g.location+"");var a=e.g.document;if(!t&&a&&(a.currentScript&&(t=a.currentScript.src),!t)){var n=a.getElementsByTagName("script");n.length&&(t=n[n.length-1].src)}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),e.p=t})(),e.p,e.p;const t=document.querySelectorAll("#show-new"),a=document.querySelector("#swich"),n=document.querySelector("#content__list"),s=document.querySelector("#storage__list"),c=document.querySelector("#search__list"),r=document.querySelector("#search-form"),o=document.querySelector(".modal-warapp"),i=document.querySelector("#search-close"),l=document.querySelector("#search-title"),d=(document.querySelector("#loader"),document.querySelector("#loadMore")),m=new class{constructor(){this.__PAGE=1}addPage(){this.__PAGE+=1}async activeFetch(e){const t=await fetch(e,{method:"GET",headers:{"X-API-KEY":"cb5f0c80-e1ab-45b3-8cee-3f02642f6379","Content-Type":"application/json"}});let{films:a}=await t.json();return this.addPage(),a=this.addMarked(a),a}async activeIDFetch(e){const t=await fetch(`https://kinopoiskapiunofficial.tech/api/v2.2/films/${e}`,{method:"GET",headers:{"X-API-KEY":"cb5f0c80-e1ab-45b3-8cee-3f02642f6379","Content-Type":"application/json"}});return{...await t.json(),marked:!0}}addMarked(e){return e.map((e=>({...e,marked:!1})))}checkIsMarked(e,t){return e.forEach((e=>{t.forEach((t=>{t.filmId!==+e||(t.marked=!0)}))})),t}innerToHTML(e,t){e.innerHTML+=t}createCard(e){return e.map(((e,t)=>`\n                    <div class="col-3 d-flex content__list__item">\n                        <div class="content__list__item__wrapp">\n                            \x3c!-- Image and rating --\x3e\n                            <div class="content__list__item__header" style="background: url(${e.posterUrlPreview}); background-repeat: no-repeat; background-size: cover">\n                                <span>${e.rating?[...e.rating][0]:"üê≥"}</span>\n                                <i data-id="${e.filmId}" class="fa-regular fa-bookmark ${e.marked?"active":""}"></i>\n                                \n                            </div>\n                            \x3c!-- END Image and rating --\x3e\n                            \x3c!-- About films --\x3e\n                            <div class="content__list__item__footer">\n                                <div class="content__list__item__footer__name">\n                                    <p data-id="${e.filmId}" class="">\n                                        ${e.nameRu}\n                                        <span>${e.year}</span>\n                                    </p>\n                                </div>\n                                <div  class="content__list__item__footer__ganre">\n                                    <p class="textToLowerCase">\n                                        ${e.genres.map((e=>e.genre)).join(", ")}\n                                    </p>\n                                </div>\n                            </div>\n                            \x3c!-- END About films --\x3e\n                        </div>\n                    </div>\n                `)).join(" ")}},h=new class{constructor(){this._lStorage=[],this.name="Films"}start(){const e=localStorage.getItem(this.name);this._lStorage=e?JSON.parse(e):[],localStorage.setItem(this.name,e||[])}addToStorage(){const e=JSON.stringify(this._lStorage);localStorage.setItem(this.name,e)}removeFromStorage(e){const t=this._lStorage.filter((t=>t!=e));this._lStorage=t}lStorage(e){this._lStorage=[...this._lStorage,e]}getData(){const e=localStorage.getItem(this.name);return e?JSON.parse(e):[]}},u=new class{async search(e){const t=`https://kinopoiskapiunofficial.tech/api/v2.1/films/search-by-keyword?keyword=${e}`,a=await fetch(t,{method:"GET",headers:{"X-API-KEY":"cb5f0c80-e1ab-45b3-8cee-3f02642f6379","Content-Type":"application/json"}}),{films:n}=await a.json();return n}};function g(){o.classList.remove("d-block"),o.classList.add("d-none"),c.innerHTML="",l.innerHTML="–ü–æ—à—É–∫ –∑–∞ —Å–ª–æ–≤–æ–º:",i.removeEventListener("click",g)}function f(e){const t=e.target,a=t.dataset.id;"I"!==t.tagName||t.classList.contains("active")?"I"===t.tagName&&t.classList.contains("active")&&(h.removeFromStorage(a),h.addToStorage(),t.classList.remove("active")):(h.lStorage(a),h.addToStorage(),t.classList.add("active"))}async function p(){const e=m.__PAGE;let t=await m.activeFetch("https://kinopoiskapiunofficial.tech/api/v2.2/films/top?type=TOP_100_POPULAR_FILMS&page="+e);const a=h.getData();t=m.checkIsMarked(a,t);const s=m.createCard(t);m.innerToHTML(n,s)}p(),h.start(),a.addEventListener("click",(function(e){const a=e.target;if(a.classList.contains("buttonActive"))a.classList.remove("buttonActive"),t[0].classList.remove("d-none"),t[1].classList.add("d-none"),s.innerHTML="";else{a.classList.add("buttonActive");const e=h.getData();e.length<=0?(console.log(e.length),s.innerHTML='<h3 style="text-align:center; color:#fff"> –ù—ñ—á–æ–≥–æ –Ω–µ–º–∞—î </h3>'):e.forEach((async e=>{const t=await m.activeIDFetch(e),a=m.createCard([t]);m.innerToHTML(s,a)})),t[0].classList.add("d-none"),t[1].classList.remove("d-none")}})),d.addEventListener("click",p),n.addEventListener("click",f),c.addEventListener("click",f),r.addEventListener("submit",(async function(e){e.preventDefault();const t=e.target.children[0].value.toLowerCase();let a=await u.search(t),n="";if(!a.length<=0){const e=h.getData();a=m.checkIsMarked(e,a),n=m.createCard(a)}else n='<h3 style="text-align:center; color:#fff"> –ù—ñ—á–æ–≥–æ –Ω–µ–º–∞—î </h3>';m.innerToHTML(c,n),e.target.children[0].value="",l.innerHTML+=` ${t}`,o.classList.contains("d-none")&&(o.classList.remove("d-none"),o.classList.add("d-block"),i.addEventListener("click",g))}))})();